{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#FFFAE5",
  "width": 1000,
  "height": 400,
  "data": {
    "url": "https://raw.githubusercontent.com/AdrianEngCheeErn/Assignment2/refs/heads/main/CPI%2C%20Goods%20and%20Services%20components%2C%20annual%20movement%20(%25).csv",
    "format": {
      "type": "csv",
      "parse": {
        "Date": "date:'%Y-%m-%d'",
        "Goods (%)": "number",
        "Services (%)": "number"
      }
    }
  },
  "params": [
    {
      "name": "Category_selection",
      "bind": {
        "input": "select",
        "options": [null, "Goods (%)", "Services (%)"],
        "labels": ["Show All", "Goods (%)", "Services (%)"],
        "name": "Select Category: "
      }
    }
  ],
  "transform": [
    {
      "fold": ["Goods (%)", "Services (%)"],
      "as": ["Category", "Value"]
    },
    {
      "calculate": "datum.Category == Category_selection || Category_selection == null ? 1 : 0.1",
      "as": "opacity_value"
    }
  ],
  "encoding": {
    "x": {
      "field": "Date",
      "type": "temporal",
      "title": "Date",
      "timeUnit": "year",
      "axis": {
        "format": "%Y",
        "tickCount": "year"
      }
    },
    "color": {
      "field": "Category",
      "type": "nominal",
      "title": "Categories",
      "scale": {
        "domain": ["Goods (%)", "Services (%)"],
        "range": ["#FF6347", "#1E90FF"]
      }
    }
  },
  "layer": [
    {
      "mark": {"type": "line"},
      "encoding": {
        "y": {"field": "Value", "type": "quantitative", "title": "Percentage (%)"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "Value", "type": "quantitative"},
          {"field": "Category", "type": "nominal"}
        ],
        "opacity": {
          "field": "opacity_value",
          "type": "quantitative",
          "legend": null
        }
      }
    },
    {
      "mark": {"type": "point", "filled": true},
      "encoding": {
        "y": {"field": "Value", "type": "quantitative"},
        "tooltip": [
          {"field": "Date", "type": "temporal", "format": "%b %Y"},
          {"field": "Value", "type": "quantitative"},
          {"field": "Category", "type": "nominal"}
        ],
        "opacity": {
          "field": "opacity_value",
          "type": "quantitative",
          "legend": null
        }
      }
    },
    {
      "transform": [
        {
          "filter": "datum['Category'] === 'Goods (%)'"
        },
        {
          "window": [{"op": "max", "field": "Value", "as": "MaxGoods"}],
          "frame": [null, null]
        },
        {"filter": "datum['Value'] === datum.MaxGoods"}
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": -60,
        "dy": -10,
        "fontWeight": "bold"
      },
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Value", "type": "quantitative"},
        "text": {"value": "Highest percentage change of 8.4%"}
      }
    },
    {
      "transform": [
        {
          "filter": "datum['Category'] === 'Services (%)'"
        },
        {
          "window": [{"op": "max", "field": "Value", "as": "MaxServices"}],
          "frame": [null, null]
        },
        {"filter": "datum['Value'] === datum.MaxServices"}
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": -60,
        "dy": -10,
        "fontWeight": "bold"
      },
      "encoding": {
        "x": {"field": "Date", "type": "temporal"},
        "y": {"field": "Value", "type": "quantitative"},
        "text": {"value": "Highest percentage change of 6.3%"}
      }
    }
  ],
  "config": {
    "view": {"stroke": "transparent"}
  }
}